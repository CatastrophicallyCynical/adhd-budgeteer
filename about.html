<!doctype html><html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>About · Budgeteer</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .swatches{display:flex; flex-wrap:wrap; gap:8px}
    /* thicker border so White is visible, inner highlight for dark colors */
    .dot{width:22px;height:22px;border-radius:50%;
         border:2px solid rgba(0,0,0,.35); box-shadow:inset 0 0 0 2px rgba(255,255,255,.35);
         cursor:pointer}
  </style>
</head>
<body>
<header>
  <div class="app-title">About</div>
  <div class="affirmation small"></div>
</header>

<div class="container">
  <div class="card">
    <div class="row" style="align-items:center">
      <div style="font-size:36px; line-height:1">❤️</div>
      <button class="btn" id="backBtn">Back</button>
    </div>
    <h2>Built with care by James for Cameron</h2>
    <div><em>You're worth every bit of frustration this code was.</em></div>
    <hr>
    <div class="small" id="ver"></div>
  </div>

  <div class="card">
    <div style="font-weight:700; margin-bottom:8px">Theme</div>
    <div class="small" style="margin-bottom:8px">Pick colors for background, panels, and text.</div>
    <div class="row"><div>Background</div><div class="swatches" id="bgSw"></div></div>
    <div class="row"><div>Panels</div><div class="swatches" id="panelSw"></div></div>
    <div class="row"><div>Text</div><div class="swatches" id="inkSw"></div></div>
    <div class="actions" style="justify-content:center; margin-top:12px">
      <button class="btn" id="saveTheme">Save Theme</button>
      <button class="btn" id="resetTheme">Reset</button>
    </div>
  </div>

  <div class="card">
    <div class="actions" style="justify-content:center">
      <button class="btn" id="export">Export settings</button>
      <button class="btn" id="import">Import settings</button>
    </div>
  </div>

  <!-- Danger Zone with extra bottom margin so it never hides under the tab bar -->
  <div class="card mb-safe">
    <div style="font-weight:700; margin-bottom:8px">Danger zone</div>
    <button class="btn" id="wipe">Delete all local data</button>
  </div>
</div>

<nav class="tabbar">
  <a href="index.html"><span class="ico">🏠</span><span>Home</span></a>
  <a href="expense.html"><span class="ico">➖</span><span>Expense</span></a>
  <a href="income.html"><span class="ico">➕</span><span>Income</span></a>
  <a href="recurring.html"><span class="ico">🔁</span><span>Recurring</span></a>
  <a href="history.html"><span class="ico">📜</span><span>History</span></a>
  <a href="about.html"><span class="ico">⚙️</span><span>About</span></a>
</nav>

<script type="module">
import { applyTheme } from './theme.js'; await applyTheme();
import { idb } from './db.js'; await idb.open();

document.getElementById('backBtn').onclick = ()=> history.back();

const meta = await fetch('./appMeta.json').then(r=>r.json()).catch(()=>({version:'—',build_timestamp:Date.now()}));
document.getElementById('ver').textContent = `Version ${meta.version} • Last updated ${new Date(meta.build_timestamp).toLocaleString()}`;

/* Palette (now includes Black & White) */
const PALETTE = [
  {name:'White',hex:'#FFFFFF'}, {name:'Black',hex:'#000000'},
  {name:'Sky',hex:'#4FC3F7'},{name:'Grass',hex:'#81C784'},{name:'Lemon',hex:'#FFD54F'},
  {name:'Coral',hex:'#FF8A65'},{name:'Lavender',hex:'#BA68C8'},{name:'Mint',hex:'#4DB6AC'},
  {name:'Sand',hex:'#FBC02D'},{name:'Slate',hex:'#90A4AE'},{name:'Rose',hex:'#F48FB1'},
  {name:'Navy',hex:'#3949AB'}
];

function renderSwatches(elId, key){
  const el = document.getElementById(elId); el.innerHTML = '';
  for(const c of PALETTE){
    const d = document.createElement('span');
    d.className='dot'; d.title = c.name; d.style.background = c.hex;
    d.addEventListener('click', ()=> pick(key, c.hex));
    el.appendChild(d);
  }
}

const picks = { bg:null, panel:null, ink:null };
function pick(key, val){
  picks[key] = val;
  document.documentElement.style.setProperty(`--${key}`, val);
}

renderSwatches('bgSw','bg');
renderSwatches('panelSw','panel');
renderSwatches('inkSw','ink');

document.getElementById('saveTheme').onclick = async ()=>{
  const s = (await idb.get('settings','app')) || {};
  s.themeCustom = {
    bg:    picks.bg    || getComputedStyle(document.documentElement).getPropertyValue('--bg').trim(),
    panel: picks.panel || getComputedStyle(document.documentElement).getPropertyValue('--panel').trim(),
    ink:   picks.ink   || getComputedStyle(document.documentElement).getPropertyValue('--ink').trim(),
  };
  await idb.set('settings','app', s);
  alert('Theme saved');
};

document.getElementById('resetTheme').onclick = async ()=>{
  const s = (await idb.get('settings','app')) || {};
  s.themeCustom = { bg:null, panel:null, ink:null };
  await idb.set('settings','app', s);
  document.documentElement.style.setProperty('--bg', '#EAE4DC');
  document.documentElement.style.setProperty('--panel', '#ffffff');
  document.documentElement.style.setProperty('--ink', '#1f2937');
  alert('Theme reset');
};

/* Export / Import */
document.getElementById('export').onclick = ()=>{
  const req = indexedDB.open('gentle-budget');
  req.onsuccess = ()=>{
    const db=req.result, tx=db.transaction(['settings','buckets','transactions','recurring']);
    const out={};
    const getAll=(store)=>new Promise(res=>{ const s=tx.objectStore(store).getAll(); s.onsuccess=()=>res(s.result) });
    Promise.all(['settings','buckets','transactions','recurring'].map(getAll)).then(([settings,buckets,transactions,recurring])=>{
      out.settings=settings; out.buckets=buckets; out.transactions=transactions; out.recurring=recurring;
      const blob = new Blob([JSON.stringify(out,null,2)], {type:'application/json'});
      const a = Object.assign(document.createElement('a'), {href:URL.createObjectURL(blob), download:'budgeteer-backup.json'}); a.click();
    });
  };
};

document.getElementById('import').onclick = ()=>{
  const input = Object.assign(document.createElement('input'),{type:'file', accept:'application/json'});
  input.onchange = async ()=>{
    const text = await input.files[0].text(); const data = JSON.parse(text);
    const req = indexedDB.open('gentle-budget');
    req.onsuccess = ()=>{
      const db=req.result;
      const tx=db.transaction(['settings','buckets','transactions','recurring'],'readwrite');
      const putAll=(store,rows)=>{ const s=tx.objectStore(store); for(const r of rows||[]) s.put(r); };
      if (Array.isArray(data.settings)) { // legacy export
        const s=tx.objectStore('settings'); s.put(data.settings[0]||data.settings,'app');
      } else if (data.settings){
        const s=tx.objectStore('settings'); s.put(data.settings,'app');
      }
      putAll('buckets',data.buckets); putAll('transactions',data.transactions); putAll('recurring',data.recurring);
      alert('Imported');
    };
  };
  input.click();
};

/* Danger Zone */
document.getElementById('wipe').onclick = ()=>{
  if (!confirm('Are you sure?? This deletes all local Budgeteer data.')) return;
  if (!confirm('ARE YOU SURE DUDE?? This cannot be undone.')) return;
  const req = indexedDB.deleteDatabase('gentle-budget');
  req.onsuccess = ()=> location.reload();
  req.onerror = ()=> alert('Could not delete database.');
};
</script>
</body></html>
