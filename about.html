<!doctype html><html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>About · Budgeteer</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <div class="app-title">About</div>
  <div class="affirmation small"></div>
</header>

<div class="container">
  <div class="card">
    <div class="row" style="align-items:center">
      <div style="font-size:36px; line-height:1">❤️</div>
      <button class="btn" id="backBtn">Back</button>
    </div>
    <h2>Built with care by James for Cameron</h2>
    <div><em>You're worth every bit of frustration this code was.</em></div>
    <hr>
    <div class="small" id="ver"></div>
  </div>

  <!-- Notifications -->
  <div class="card">
    <div style="font-weight:700; margin-bottom:8px">Notifications</div>

    <div class="row" style="align-items:center; flex-wrap:wrap; gap:12px">
      <div style="min-width:140px">Daily nudge</div>
      <input type="time" id="dailyTime" value="10:00" style="max-width:150px">
      <label class="small" style="display:flex; align-items:center; gap:6px">
        <input type="checkbox" id="dailyEnabled" checked> Enabled
      </label>
      <button class="btn" id="testDaily">Test</button>
    </div>

    <div class="row" style="align-items:center; flex-wrap:wrap; gap:12px; margin-top:8px">
      <div style="min-width:140px">Sunday reset</div>
      <input type="time" id="sunTime" value="12:00" style="max-width:150px">
      <label class="small" style="display:flex; align-items:center; gap:6px">
        <input type="checkbox" id="sunEnabled" checked> Enabled
      </label>
      <button class="btn" id="testSun">Test</button>
    </div>

    <div class="row" style="align-items:center; flex-wrap:wrap; gap:12px; margin-top:8px">
      <div style="min-width:140px">Mid-week check</div>
      <input type="time" id="midTime" value="10:00" style="max-width:150px">
      <label class="small" style="display:flex; align-items:center; gap:6px">
        <input type="checkbox" id="midEnabled" checked> Enabled
      </label>
      <button class="btn" id="testMid">Test</button>
    </div>

    <hr style="margin:12px 0">

    <div class="row" style="align-items:center; flex-wrap:wrap; gap:12px">
      <div style="min-width:140px">Recurring confirms</div>
      <label class="small" style="display:flex; align-items:center; gap:6px">
        <input type="checkbox" id="confirmEnabled" checked> Ask “Yes / No”
      </label>
    </div>

    <div class="actions" style="justify-content:center; margin-top:12px">
      <button class="btn primary" id="saveNotifs">Save</button>
    </div>

    <div class="small" style="margin-top:8px">
      Notes: Notifications are local (no server). They trigger when the app is open or opened near the time.
      Recurring “Yes/No” uses an in-app dialog at the due minute.
    </div>
  </div>

  <div class="card">
    <div class="actions" style="justify-content:center">
      <button class="btn" id="export">Export settings</button>
      <button class="btn" id="import">Import settings</button>
    </div>
  </div>

  <div class="card mb-safe">
    <div style="font-weight:700; margin-bottom:8px">Danger zone</div>
    <button class="btn" id="wipe">Delete all local data</button>
  </div>
</div>

<nav class="tabbar">
  <a href="index.html"><span class="ico">🏠</span><span>Home</span></a>
  <a href="expense.html"><span class="ico">➖</span><span>Expense</span></a>
  <a href="income.html"><span class="ico">➕</span><span>Income</span></a>
  <a href="history.html"><span class="ico">📜</span><span>History</span></a>
  <a href="about.html"><span class="ico">⚙️</span><span>About</span></a>
</nav>

<script src="notify.js"></script>
<script>
// Back + version
document.getElementById('backBtn').onclick = ()=> history.back();
document.getElementById('ver').textContent = `Local data • ${new Date().toLocaleString()}`;

// Export/Import
function exportSettings(){
  const out = {
    budgeteer_expenses: JSON.parse(localStorage.getItem('budgeteer_expenses')||'[]'),
    budgeteer_income: JSON.parse(localStorage.getItem('budgeteer_income')||'[]'),
    budgeteer_recurring: JSON.parse(localStorage.getItem('budgeteer_recurring')||'[]'),
    budgeteer_nudge: JSON.parse(localStorage.getItem('budgeteer_nudge')||'{}')
  };
  const blob = new Blob([JSON.stringify(out,null,2)], {type:'application/json'});
  const a = Object.assign(document.createElement('a'), {href:URL.createObjectURL(blob), download:'budgeteer-backup.json'}); a.click();
}
function importSettings(){
  const input = Object.assign(document.createElement('input'),{type:'file', accept:'application/json'});
  input.onchange = async ()=>{
    try{
      const text = await input.files[0].text(); const data = JSON.parse(text);
      if (data.budgeteer_expenses) localStorage.setItem('budgeteer_expenses', JSON.stringify(data.budgeteer_expenses));
      if (data.budgeteer_income) localStorage.setItem('budgeteer_income', JSON.stringify(data.budgeteer_income));
      if (data.budgeteer_recurring) localStorage.setItem('budgeteer_recurring', JSON.stringify(data.budgeteer_recurring));
      if (data.budgeteer_nudge) localStorage.setItem('budgeteer_nudge', JSON.stringify(data.budgeteer_nudge));
      alert('Imported');
      location.reload();
    }catch{ alert('Import failed'); }
  };
  input.click();
}
function wipeAll(){
  if (!confirm('Are you sure?? This deletes all local Budgeteer data.')) return;
  if (!confirm('ARE YOU SURE DUDE?? This cannot be undone.')) return;
  localStorage.clear(); location.reload();
}
document.getElementById('export').onclick = exportSettings;
document.getElementById('import').onclick = importSettings;
document.getElementById('wipe').onclick = wipeAll;

// Notifications UI
const api = window.__budgeteerNotify;
(function initNotifs(){
  const s = api.get();

  document.getElementById('dailyTime').value = s.daily.time || '10:00';
  document.getElementById('dailyEnabled').checked = !!s.daily.enabled;

  document.getElementById('sunTime').value = s.weekly.sun.time || '12:00';
  document.getElementById('sunEnabled').checked = !!s.weekly.sun.enabled;

  document.getElementById('midTime').value = s.weekly.mid.time || '10:00';
  document.getElementById('midEnabled').checked = !!s.weekly.mid.enabled;

  document.getElementById('confirmEnabled').checked = !!s.confirm.enabled;

  document.getElementById('testDaily').onclick = ()=> api.test('daily');
  document.getElementById('testSun').onclick   = ()=> api.test('sun');
  document.getElementById('testMid').onclick   = ()=> api.test('mid');

  document.getElementById('saveNotifs').onclick = ()=>{
    const patch = {
      daily:  { enabled: document.getElementById('dailyEnabled').checked,
                time:    document.getElementById('dailyTime').value || '10:00',
                last: '' },
      weekly: {
        sun: { enabled: document.getElementById('sunEnabled').checked,
               time:    document.getElementById('sunTime').value || '12:00',
               last: '' },
        mid: { enabled: document.getElementById('midEnabled').checked,
               time:    document.getElementById('midTime').value || '10:00',
               last: '' }
      },
      confirm:{ enabled: document.getElementById('confirmEnabled').checked }
    };
    api.set(patch);
    alert('Saved!');
  };
})();
</script>
</body></html>
