<!doctype html><html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>History · Budgeteer</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header><div class="app-title">History</div></header>
<div class="container">
  <div class="card">
    <div class="row" style="gap:8px; align-items:center">
      <button class="btn" id="prev">◀</button>
      <div class="kbd" id="monthTitle"></div>
      <button class="btn" id="next">▶</button>
      <select id="type"><option value="all">All</option><option value="income">Income</option><option value="expense">Expenses</option></select>
    </div>
  </div>
  <div class="card" id="list"></div>
</div>
<nav class="tabbar">
  <a href="index.html"><span class="ico">🏠</span><span>Home</span></a>
  <a href="expense.html"><span class="ico">➖</span><span>Expense</span></a>
  <a href="income.html"><span class="ico">➕</span><span>Income</span></a>
  <a href="history.html"><span class="ico">📜</span><span>History</span></a>
  <a href="about.html"><span class="ico">⚙️</span><span>About</span></a>
</nav>
<script>
function load(k,d){ try{ return JSON.parse(localStorage.getItem(k)) ?? d; }catch{ return d; } }
function title(y,m){ return new Date(y,m,1).toLocaleString(undefined,{month:'long',year:'numeric'}); }
function range(y,m){ return [new Date(y,m,1).getTime(), new Date(y,m+1,1).getTime()]; }

let Y=new Date().getFullYear(), M=new Date().getMonth();
document.getElementById('prev').onclick=()=>{ if(--M<0){M=11;Y--;} render(); };
document.getElementById('next').onclick=()=>{ if(++M>11){M=0;Y++;} render(); };
document.getElementById('type').onchange=()=> render();

function render(){
  document.getElementById('monthTitle').textContent = title(Y,M);
  const [s,e]=range(Y,M);
  const exp = load('budgeteer_expenses', []).map(x=>({type:'exp',...x,ts:new Date(x.date+'T12:00').getTime()}));
  const inc = load('budgeteer_income', []).map(x=>({type:'inc',...x,ts:new Date(x.date+'T12:00').getTime()}));
  const rows = [...exp,...inc].filter(x=>x.ts>=s&&x.ts<e).sort((a,b)=>b.ts-a.ts);

  const f=document.getElementById('type').value;
  const filtered = rows.filter(r=> f==='all' ? true : (f==='income'? r.type==='inc' : r.type==='exp'));

  const list = document.getElementById('list');
  list.innerHTML = filtered.length ? '' : '<div class="small">No entries.</div>';
  for(const r of filtered){
    const div=document.createElement('div'); div.className='row'; div.style.borderTop='1px solid #e5e7eb'; div.style.padding='8px 0';
    const amt = (r.type==='inc'? '+' : '') + Number(r.amount).toFixed(2);
    div.innerHTML = `<div class="small">${new Date(r.ts).toLocaleString()} • ${(r.note||'—').replace(/</g,'&lt;')}</div><div class="small">${amt}</div>`;
    list.appendChild(div);
  }
}
render();
</script>
</body></html>
